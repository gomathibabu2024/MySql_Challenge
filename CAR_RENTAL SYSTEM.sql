USE SAMPLE;

CREATE TABLE VEHICLE (
    VEHICLEID INT PRIMARY KEY,
    MAKE VARCHAR(50),
    MODEL VARCHAR(50) NOT NULL, 
    YEAR INT NOT NULL,
    DAILYRATE DECIMAL(10,2),
    STATUS TINYINT CHECK (STATUS IN (0, 1)),
    PASSENGER_CAPACITY INT CHECK (PASSENGER_CAPACITY > 0),
    ENGINE_CAPACITY INT
);


INSERT INTO VEHICLE VALUES
(1, 'Toyota', 'Camry', 2022, 50.00, 1, 4, 1450),
(2, 'Honda', 'Civic', 2023, 45.00, 1, 7, 1500),
(3, 'Ford', 'Focus', 2022, 48.00, 0, 4, 1400),
(4, 'Nissan', 'Altima', 2023, 52.00, 1, 7, 1200),
(5, 'Chevrolet', 'Malibu', 2022, 47.00, 1, 4, 1800),
(6, 'Hyundai', 'Sonata', 2023, 49.00, 0, 7, 1400),
(7, 'BMW', '3 Series', 2023, 60.00, 1, 7, 2499),
(8, 'Mercedes', 'C-Class', 2022, 58.00, 1, 8, 2599),
(9, 'Audi', 'A4', 2022, 55.00, 0, 4, 2500),
(10, 'Lexus', 'ES', 2023, 54.00, 1, 4, 2500);

SELECT * FROM VEHICLE;

CREATE TABLE CUSTOMER (
CUSTID INT PRIMARY KEY,
FIRSTNAME VARCHAR(50) NOT NULL,
LASTNAME VARCHAR(50) NOT NULL,
EMAIL VARCHAR(50) NOT NULL,
PHONE VARCHAR(15) NOT NULL
);

INSERT INTO CUSTOMER VALUES
(1, 'John', 'Doe', 'johndoe@example.com', '555-555-5555'),
(2, 'Jane', 'Smith', 'janesmith@example.com', '555-123-4567'),
(3, 'Robert', 'Johnson', 'robert@example.com', '555-789-1234'),
(4, 'Sarah', 'Brown', 'sarah@example.com', '555-456-7890'),
(5, 'David', 'Lee', 'david@example.com', '555-987-6543'),
(6, 'Laura', 'Hall', 'laura@example.com', '555-234-5678'),
(7, 'Michael', 'Davis', 'michael@example.com', '555-876-5432'),
(8, 'Emma', 'Wilson', 'emma@example.com', '555-432-1098'),
(9, 'William', 'Taylor', 'william@example.com', '555-321-6547'),
(10, 'Olivia', 'Adams', 'olivia@example.com', '555-765-4321');

SELECT * FROM CUSTOMER;

CREATE TABLE LEASE (
    LEASEID INT PRIMARY KEY,
    VEHICLEID INT,
    CUSTID INT,
    STARTDATE DATE,
    ENDDATE DATE,
    TYPE VARCHAR(20),
    FOREIGN KEY (VEHICLEID) REFERENCES VEHICLE(VEHICLEID),
    FOREIGN KEY (CUSTID) REFERENCES CUSTOMER(CUSTID)
);

INSERT INTO LEASE VALUES
(1, 1, 1, '2023-01-01', '2023-01-05', 'Daily'),
(2, 2, 2, '2023-02-15', '2023-02-28', 'Monthly'),
(3, 3, 3, '2023-03-10', '2023-03-15', 'Daily'),
(4, 4, 4, '2023-04-20', '2023-04-30', 'Monthly'),
(5, 5, 5, '2023-05-05', '2023-05-10', 'Daily'),
(6, 4, 3, '2023-06-15', '2023-06-30', 'Monthly'),
(7, 7, 7, '2023-07-01', '2023-07-10', 'Daily'),
(8, 8, 8, '2023-08-12', '2023-08-15', 'Monthly'),
(9, 3, 3, '2023-09-07', '2023-09-10', 'Daily'),
(10, 10, 10, '2023-10-10', '2023-10-31', 'Monthly');

SELECT * FROM LEASE;

CREATE TABLE PAYMENT (
    PAYMENTID INT PRIMARY KEY,
    LEASEID INT,
    PAYMENTDATE DATE,
    AMOUNT DECIMAL(10,2),
    FOREIGN KEY (LEASEID) REFERENCES LEASE(LEASEID)
);

INSERT INTO PAYMENT VALUES
(1, 1, '2023-01-03', 200.00),
(2, 2, '2023-02-20', 1000.00),
(3, 3, '2023-03-12', 75.00),
(4, 4, '2023-04-25', 900.00),
(5, 5, '2023-05-07', 60.00),
(6, 6, '2023-06-18', 1200.00),
(7, 7, '2023-07-03', 40.00),
(8, 8, '2023-08-14', 1100.00),
(9, 9, '2023-09-09', 80.00),
(10, 10, '2023-10-25', 950.00);

SELECT * FROM PAYMENT;


UPDATE VEHICLE 	
SET DAILYRATE = 68.00
WHERE MAKE='MERCEDES';

DELETE FROM PAYMENT
WHERE LEASEID IN (
    SELECT LEASEID FROM LEASE WHERE CUSTID = 5
);
DELETE FROM LEASE
WHERE CUSTID = 5;
DELETE FROM CUSTOMER 
WHERE CUSTID=5;

ALTER TABLE Payment
RENAME COLUMN PAYMENTDATE TO TRANSACTIONDATE;

SELECT * 
FROM CUSTOMER 
WHERE EMAIL='olivia@example.com';

SELECT L.*
FROM LEASE L
JOIN CUSTOMER C ON L.CUSTID = C.CUSTID
WHERE C.FIRSTNAME='LAURA'
  AND CURDATE() BETWEEN L.STARTDATE AND L.ENDDATE;

SELECT P.PAYMENTID, P.TRANSACTIONDATE, P.AMOUNT, L.LEASEID, C.FIRSTNAME, C.LASTNAME
FROM PAYMENT P
JOIN LEASE L ON P.LEASEID = L.LEASEID
JOIN CUSTOMER C ON L.CUSTID = C.CUSTID
WHERE C.PHONE = '555-456-7890';

SELECT AVG(DAILYRATE)
FROM VEHICLE 
WHERE STATUS=1;

SELECT MAX(DAILYRATE)
FROM VEHICLE
WHERE STATUS=1;

SELECT V.*
FROM VEHICLE V
JOIN LEASE L ON V.VEHICLEID = L.VEHICLEID
WHERE L.CUSTID = 8;

SELECT *
FROM LEASE
ORDER BY STARTDATE DESC
LIMIT 1;

SELECT *
FROM PAYMENT
WHERE YEAR(TRANSACTIONDATE) = 2023;

SELECT DISTINCT C.*
FROM CUSTOMER C
JOIN LEASE L ON C.CUSTID = L.CUSTID
LEFT JOIN PAYMENT P ON L.LEASEID = P.LEASEID
WHERE P.PAYMENTID IS NULL;

SELECT 
    V.VEHICLEID,
    V.MAKE,
    V.MODEL,
    V.YEAR,
    V.DAILYRATE,
    SUM(P.AMOUNT) AS TotalPayments
FROM VEHICLE V
JOIN LEASE L ON V.VEHICLEID = L.VEHICLEID
JOIN PAYMENT P ON L.LEASEID = P.LEASEID
GROUP BY V.VEHICLEID, V.MAKE, V.MODEL, V.YEAR, V.DAILYRATE;

SELECT 
    C.CUSTID,
    C.FIRSTNAME,
    C.LASTNAME,
    SUM(P.AMOUNT) AS TotalPayments
FROM CUSTOMER C
JOIN LEASE L ON C.CUSTID = L.CUSTID
JOIN PAYMENT P ON L.LEASEID = P.LEASEID
GROUP BY C.CUSTID, C.FIRSTNAME, C.LASTNAME;

SELECT 
    L.LEASEID,
    V.VEHICLEID,
    V.MAKE,
    V.MODEL,
    V.YEAR,
    V.DAILYRATE,
    V.STATUS,
    V.PASSENGER_CAPACITY,
    V.ENGINE_CAPACITY
FROM LEASE L
JOIN VEHICLE V ON L.VEHICLEID = V.VEHICLEID;

SELECT 
    L.LEASEID,
    L.STARTDATE,
    L.ENDDATE,
    L.TYPE,
    C.CUSTID,
    C.FIRSTNAME,
    C.LASTNAME,
    C.PHONE,
    V.VEHICLEID,
    V.MAKE,
    V.MODEL,
    V.YEAR,
    V.DAILYRATE
FROM LEASE L
JOIN CUSTOMER C ON L.CUSTID = C.CUSTID
JOIN VEHICLE V ON L.VEHICLEID = V.VEHICLEID
WHERE CURDATE() BETWEEN L.STARTDATE AND L.ENDDATE;

SELECT 
    C.CUSTID,
    C.FIRSTNAME,
    C.LASTNAME,
    SUM(P.AMOUNT) AS TotalSpent
FROM CUSTOMER C
JOIN LEASE L ON C.CUSTID = L.CUSTID
JOIN PAYMENT P ON L.LEASEID = P.LEASEID
GROUP BY C.CUSTID, C.FIRSTNAME, C.LASTNAME
ORDER BY TotalSpent DESC
LIMIT 1;

SELECT
    V.VEHICLEID,
    V.MAKE,
    V.MODEL,
    V.YEAR,
    V.DAILYRATE,
    L.LEASEID,
    L.CUSTID,
    L.STARTDATE,
    L.ENDDATE,
    L.TYPE
FROM VEHICLE V
LEFT JOIN LEASE L ON V.VEHICLEID = L.VEHICLEID
    AND CURDATE() BETWEEN L.STARTDATE AND L.ENDDATE;
    
